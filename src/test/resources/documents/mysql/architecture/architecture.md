## mysql架构
### 逻辑架构
 ![](./mysql-architecture.jpeg)
* 连接层
* 服务层
* 引擎层
* 存储层

### 脚本流程
#### 简化版
![](./mysql-script-execution-sketch-progress.jpg)

#### 复杂版
![](./mysql-script-execution-complex-progress.png)
上图中，整个架构分为两层，上层是MySQLD的，被称为的‘SQL Layer'，下层是各种各样，对上提供接口的存储引擎，被称为‘Storage Engine Layer'。<br>
执行流程<br>
1.连接<br>
　　1.1客户端发起一条Query请求，监听客户端的‘连接管理模块'接收请求<br>
　　1.2将请求转发到‘连接进/线程模块'<br>
　　1.3调用‘用户模块'来进行授权检查<br>
　　1.4通过检查后，‘连接进/线程模块'从‘线程连接池'中取出空闲的被缓存的连接线程和客户端请求对接，如果失败则创建一个新的连接请求<br>
2.处理<br>
　　2.1先查询缓存，检查Query语句是否完全匹配，接着再检查是否具有权限，都成功则直接取数据返回<br>
　　2.2上一步有失败则转交给‘命令解析器'，经过词法分析，语法分析后生成解析树<br>
　　2.3接下来是预处理阶段，处理解析器无法解决的语义，检查权限等，生成新的解析树<br>
　　2.4再转交给对应的模块处理<br>
　　2.5如果是SELECT查询还会经由‘查询优化器'做大量的优化，生成执行计划<br>
　　2.6模块收到请求后，通过‘访问控制模块'检查所连接的用户是否有访问目标表和目标字段的权限<br>
　　2.7有则调用‘表管理模块'，先是查看table cache中是否存在，有则直接对应的表和获取锁，否则重新打开表文件<br>
　　2.8根据表的meta数据，获取表的存储引擎类型等信息，通过接口调用对应的存储引擎处理<br>
　　2.9上述过程中产生数据变化的时候，若打开日志功能，则会记录到相应二进制日志文件中<br>
3.结果<br>
　　3.1Query请求完成后，将结果集返回给‘连接进/线程模块'<br>
　　3.2返回的也可以是相应的状态标识，如成功或失败等<br>
　　3.3‘连接进/线程模块'进行后续的清理工作，并继续等待请求或断开与客户端的连接<br>

整理自[SQL语句执行深入讲解](http://www.uxys.com/html/MySQL/20200203/69945.html)

### 引擎
![](./mysql-common-engines.png)

### 存储

